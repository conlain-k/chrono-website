<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- For Mobile Devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta name="generator" content="Doxygen 1.8.11"/>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <link rel="stylesheet" href='http://fonts.googleapis.com/css?family=Exo+2:400,200,700' type='text/css'>
    <title>Project Chrono: Collision shapes</title>
    <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
    <script type="text/javascript" src="dynsections.js"></script>
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
    <link href="main.css" rel="stylesheet" type="text/css" />
    <!--  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css"> -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="doxy-boot.js"></script>
    <script type="text/javascript" src="bootstrap-hover-dropdown.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://projectchrono.org">
            <span class="logo first">PROJECT</span><span class="logo second">CHRONO</span>
        </a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="http://projectchrono.org/download">Download</a></li>
        <li class="dropdown">
            <a href="http://api.chrono.projectchrono.org" class="dropdown-toggle disabled" data-hover="dropdown" data-toggle="dropdown" data-delay="100" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="http://api.chrono.projectchrono.org/faq_root.html">FAQ</a></li>
                <li><a href="http://api.chrono.projectchrono.org/tutorial_table_of_content_install.html">Install Guide</a></li>
                <li><a href="http://api.chrono.projectchrono.org/tutorial_root.html">Examples/Tutorials</a></li>
                <li><a href="http://api.chrono.projectchrono.org/model_root.html">Model Library</a></li>
                <li><a href="http://api.chrono.projectchrono.org/validation_studies_root.html">Validation Studies</a></li>
                <li><a href="http://api.chrono.projectchrono.org/whitepaper_root.html">White Papers</a></li>
                <li><a href="http://projectchrono.org/docpdf">PDF Version</a></li>
            </ul>
        </li>
        <li class="dropdown">
            <a href="http://projectchrono.org/gallery/" class="dropdown-toggle disabled" data-hover="dropdown" data-toggle="dropdown" data-delay="100" role="button" style="dropdown:hover" aria-haspopup="true" aria-expanded="false">Movies <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="http://projectchrono.org/gallery/">Gallery</a></li>
                <li><a href="http://sbel.wisc.edu/Animations/">SBEL</a></li>
                <li><a href="https://vimeo.com/uwsbel">On Vimeo</a></li>
            </ul>
        </li>
        <li><a href="http://projectchrono.org/news/">News</a></li>
        <li><a href="http://projectchrono.org/forum">Forum</a></li>
		<li class="dropdown">
            <a href="http://projectchrono.org/about/" class="dropdown-toggle disabled" data-hover="dropdown" data-toggle="dropdown" data-delay="100" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="http://projectchrono.org/about/">What is ProjectChrono</a></li>
                <li><a href="http://projectchrono.org/testimonials/">Users</a></li>
            </ul>
        </li>
        <li><a href="http://projectchrono.org/status">Status</a></li>            
            <li>
              <form method="get" action="http://projectchrono.org/search" id="search_bar_triggered">
                          <input type="submit" value="Search">
                <input type="text" id="search_bar" name="query" value="" />
              </form> 
            </li>
    </ul>
          <!-- <ul class="nav navbar-nav navbar-right">
      </ul> -->
  </div><!--/.navbar-collapse -->
</div>
</nav>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div class="content" id="content">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 panel panel-default" style="padding-bottom: 15px;">
                    <div style="margin-bottom: 15px;">
                        <!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Project Chrono API/SDK documentation</a></li><li class="navelem"><a class="el" href="manual_root.html">Reference Manual</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Collision shapes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Collision shapes can be added optionally to ChBody objects. Having collision shapes attached to bodies enable them to interact during simulation with other bodies through friction and contact.</p>
<h1><a class="anchor" id="collision_models"></a>
Collision models</h1>
<p>Each body contains a ChCollisionModel. This can be used to define the collision shapes.</p>
<div class="image">
<img src="pic_ChCollisionModel.png" alt="pic_ChCollisionModel.png"/>
</div>
<ul>
<li>Collision shapes are defined with respect to the REF frame of the <a class="el" href="rigid_bodies.html">body</a></li>
<li>Examples of shapes: spheres, boxes, cylinders, convex hulls, ellipsoids, compounds, etc.</li>
<li>One can add multiple collision shapes to a rigid body. However, compound shapes will slow down the collision detection phase of the simulation. In this context, there is no geometry simpler to handle than a sphere that is located at the center of mass of the rigid body.</li>
<li>Handling of concave shapes falls back on a decomposition of the geometry in a union of convex shapes</li>
<li>For simple ready-to-use bodies that already contain collision shapes, use ChBodyEasySphere, ChBodyEasyBox, etc. (see <a class="el" href="rigid_bodies.html#manual_otherbodies">body manual pages</a></li>
<li>Collision shapes and visualization assets do not need to match; e. g. one may have a detailed visualization shape for rendering purposes, yet the collision shape is much simpler to avoid a slowdown of the simulation.</li>
<li>Avoid shapes that are too thin, too flat or in general that lead to extreme size ratios</li>
</ul>
<p>Steps to set up collision after you create a ChBody:</p>
<div class="fragment"><div class="line">body_b-&gt;GetCollisionModel()-&gt;ClearModel();</div><div class="line">body_b-&gt;GetCollisionModel()-&gt;AddSphere(myradius);</div><div class="line">... </div><div class="line">body_b-&gt;GetCollisionModel()-&gt;BuildModel();</div><div class="line">body_b-&gt;SetCollide(<span class="keyword">true</span>);</div></div><!-- fragment --><h1><a class="anchor" id="collision_families"></a>
Collision families</h1>
<p>You can define <em>collision families</em> for selective collisions. For example you may not want the object of family=2 to collide with any objects of family=4:</p>
<div class="fragment"><div class="line"><span class="comment">// default collision family is 0. Change it:</span></div><div class="line">body_b-&gt;GetCollisionModel()-&gt;SetFamily(2); </div><div class="line">body_b-&gt;SetFamilyMaskNoCollisionWithFamily(4);</div></div><!-- fragment --><p>Currently, Chrono allows up to 15 different collision families that can be involved in a simulation.</p>
<h1><a class="anchor" id="collision_materials"></a>
Collision materials</h1>
<p>Adding collision shapes to a body typically requires the user to define the friction coefficient of the surface. This observation also holds for other collision-specific properties such as rolling friction, coefficient of restitution, etc. This can be done in two ways.</p>
<p><b>Easy</b> (Memory consuming):</p>
<div class="fragment"><div class="line">body_b-&gt;SetFriction(0.4f);</div><div class="line">body_b-&gt;SetRollingFriction(0.001f);</div></div><!-- fragment --><p><b>Advanced</b> (Shared material). A ChSharedMaterial is created and subsequently used for one or more bodies:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a surface material and change properties:</span></div><div class="line">ChSharedPtr&lt;ChMaterialSurface&gt; mat(<span class="keyword">new</span> ChMaterialSurface);</div><div class="line">mat-&gt;SetFriction(0.4f);</div><div class="line">mat-&gt;SetRollingFriction(0.001f);</div><div class="line"></div><div class="line"><span class="comment">// Assign surface material to body/bodies:</span></div><div class="line">body_b-&gt;SetSurfaceMaterial(mat); </div><div class="line">body_c-&gt;SetSurfaceMaterial(mat);</div><div class="line">body_d-&gt;SetSurfaceMaterial(mat);</div></div><!-- fragment --><h1><a class="anchor" id="collision_tolerances"></a>
Collision tolerances</h1>
<p>Each collision model has two tolerance used by collision engine to create and delete contacts:</p>
<ul>
<li>An outward safe <b>envelope</b>. This represents the volume where potential contacts are searched. In other words, for the sake of collision detection the body becomes puffy, or inflated, by a small amount that is user controlled. Rationale: although at the beginning of a time step two bodies might not be in contact, during the duration of one integration time step they might come in contact. This envelope provisions for this possibility. More specifically, this envelope is needed by the numerical schemes since they must anticipate contacts ahead of time. If these contacts were sent to the solver when objects are already interpenetrating, the motion could be shaky and less accurate. Having a too large envelope will produce a lot of false positives (in terms of contacts), which will slow down both the collision detection and the solution stage. The latter is due to the fact that a lot of contacts will be solved only to produce a ``zero contact force'' answer.</li>
<li>An inward <b>margin</b>. Two collision shapes belonging to different bodies might interpenetrate even if considered rigid owing to numerical integration errors, collision detection approximations, ill specified initial conditions, etc. The 'go-to' collision detection algorithm can support interpenetration up to this <em>margin</em>. When this margin is crossed, the solver falls back on a slower collision detection algorithm.</li>
</ul>
<p>The fast collision algorithm must run between 'shrunk' versions of the shapes, and the original shape is recovered later by offsetting the collision points outward. Hence the rounding effect. In the picture below, the two blue shapes were added as sharp boxes, but the effect from the point of view of collision is like having boxes with rounded corners whose rounding radius is the collision margin.</p>
<div class="image">
<img src="pic_margins.png" alt="pic_margins.png"/>
</div>
<p>Drawbacks to poor envelope and/or margin choices:</p>
<ul>
<li>Collision envelope too large:<ul>
<li>Many potential contacts</li>
<li>High CPU time</li>
<li>Waste of memory</li>
</ul>
</li>
<li>Collision envelope too small:<ul>
<li>Risk of tunnelling effects</li>
<li>Unstable, shaky simulation, particularly when dealing with stacked objects</li>
</ul>
</li>
<li>Collision margin too large:<ul>
<li>Shapes appear too ''rounded''</li>
</ul>
</li>
<li>Collision margin too small:<ul>
<li>When interpenetration occurs beyond this value, an inefficient algorithm is used</li>
</ul>
</li>
</ul>
<p>Setting the value of the envelope/margin:</p>
<div class="fragment"><div class="line">ChCollisionModel::SetDefaultSuggestedEnvelope(0.001); </div><div class="line">ChCollisionModel::SetDefaultSuggestedMargin  (0.0005); </div></div><!-- fragment --><div class="ce-info"> These settings will affect collision shapes that are created <b>after</b> these function calls.</div><div class="ce-info">SetDefaultSuggestedEnvelope and SetDefaultSuggestedMargin can be called multiple times, but once the collision model is populated with collision shapes the envelopes and margins cannot be changed. </div><p>Finally, there is also a <b>contact breaking threshold</b>, which is a global tolerance for all models. It can be set as in this example:</p>
<div class="fragment"><div class="line">ChCollisionSystemBullet::SetContactBreakingThreshold(0.001);</div></div><!-- fragment --><p>The contact breaking threshold represents the maximum distance between two collision shapes where were in contact before the contact is considered as non-existent. This is due to the fact that Chrono relies in many instances on the Bullet collision algorithms and Bullet keeps contact points persistent from one simulation frame to the next. This threshold value instructs Bullet when to severe the contact between the two collision shapes.</p>
<h1>Examples</h1>
<p>For further guidance, see:</p><ul>
<li>demo_bricks.cpp</li>
<li>demo_collision.cpp</li>
<li>demo_friction.cpp </li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 1 2016 15:43:09 for Project Chrono by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11 . <a href="mailto:info@projectchrono.org">Contact us</a> for issues related to this page. 
</small></address>
</body>
</html>
