<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- For Mobile Devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta name="generator" content="Doxygen 1.8.11"/>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <link rel="stylesheet" href='http://fonts.googleapis.com/css?family=Exo+2:400,200,700' type='text/css'>
    <title>Project Chrono: Archives and serialization in Chrono (demo_archive.cpp)</title>
    <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
    <script type="text/javascript" src="dynsections.js"></script>
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
    <link href="main.css" rel="stylesheet" type="text/css" />
    <!--  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css"> -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="doxy-boot.js"></script>
    <script type="text/javascript" src="bootstrap-hover-dropdown.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://projectchrono.org">
            <span class="logo first">PROJECT</span><span class="logo second">CHRONO</span>
        </a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="http://projectchrono.org/download">Download</a></li>
        <li class="dropdown">
            <a href="http://api.chrono.projectchrono.org" class="dropdown-toggle disabled" data-hover="dropdown" data-toggle="dropdown" data-delay="100" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="http://api.chrono.projectchrono.org/faq_root.html">FAQ</a></li>
                <li><a href="http://api.chrono.projectchrono.org/tutorial_table_of_content_install.html">Install Guide</a></li>
                <li><a href="http://api.chrono.projectchrono.org/tutorial_root.html">Examples/Tutorials</a></li>
                <li><a href="http://api.chrono.projectchrono.org/model_root.html">Model Library</a></li>
                <li><a href="http://api.chrono.projectchrono.org/validation_studies_root.html">Validation Studies</a></li>
                <li><a href="http://api.chrono.projectchrono.org/whitepaper_root.html">White Papers</a></li>
                <li><a href="http://projectchrono.org/docpdf">PDF Version</a></li>
            </ul>
        </li>
        <li class="dropdown">
            <a href="http://projectchrono.org/gallery/" class="dropdown-toggle disabled" data-hover="dropdown" data-toggle="dropdown" data-delay="100" role="button" style="dropdown:hover" aria-haspopup="true" aria-expanded="false">Movies <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="http://projectchrono.org/gallery/">Gallery</a></li>
                <li><a href="http://sbel.wisc.edu/Animations/">SBEL</a></li>
                <li><a href="https://vimeo.com/uwsbel">On Vimeo</a></li>
            </ul>
        </li>
        <li><a href="http://projectchrono.org/news/">News</a></li>
        <li><a href="http://projectchrono.org/forum">Forum</a></li>
		<li class="dropdown">
            <a href="http://projectchrono.org/about/" class="dropdown-toggle disabled" data-hover="dropdown" data-toggle="dropdown" data-delay="100" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="http://projectchrono.org/about/">What is ProjectChrono</a></li>
                <li><a href="http://projectchrono.org/testimonials/">Users</a></li>
            </ul>
        </li>
        <li><a href="http://projectchrono.org/status">Status</a></li>            
            <li>
              <form method="get" action="http://projectchrono.org/search" id="search_bar_triggered">
                          <input type="submit" value="Search">
                <input type="text" id="search_bar" name="query" value="" />
              </form> 
            </li>
    </ul>
          <!-- <ul class="nav navbar-nav navbar-right">
      </ul> -->
  </div><!--/.navbar-collapse -->
</div>
</nav>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div class="content" id="content">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 panel panel-default" style="padding-bottom: 15px;">
                    <div style="margin-bottom: 15px;">
                        <!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Project Chrono API/SDK documentation</a></li><li class="navelem"><a class="el" href="manual_root.html">Reference Manual</a></li><li class="navelem"><a class="el" href="tutorial_root.html">Tutorials</a></li><li class="navelem"><a class="el" href="tutorial_table_of_content_chrono.html">Chrono core tutorials</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Archives and serialization in Chrono (demo_archive.cpp) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Tutorial on serialization. Learn how to write serializa C++ classes in various formats:</p><ul>
<li>JSON</li>
<li>binary (platform independent)</li>
<li>ASCII</li>
<li>etc.</li>
</ul>
<p>The serialization system in Chrono support class versions, automatic pointer serialization, and other features. Look at the code.</p>
<p>No GUI: only text output.</p>
<div class="fragment"><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// PROJECT CHRONO - http://projectchrono.org</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Copyright (c) 2010 Alessandro Tasora</span></div><div class="line"><span class="comment">// All rights reserved.</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Use of this source code is governed by a BSD-style license that can be</span></div><div class="line"><span class="comment">// found in the LICENSE file at the top level of the distribution</span></div><div class="line"><span class="comment">// and at http://projectchrono.org/license-chrono.txt.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//   Demos code about</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//     - archives for serialization,</span></div><div class="line"><span class="comment">//     - serialization, with versioning and dynamic</span></div><div class="line"><span class="comment">//       creation (class factory)</span></div><div class="line"><span class="comment">//     - class runtime type identification, without</span></div><div class="line"><span class="comment">//       enabling the RTTI compiler feature</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="preprocessor">#include &lt;typeinfo&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;chrono/serialization/ChArchive.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;chrono/serialization/ChArchiveBinary.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;chrono/serialization/ChArchiveAsciiDump.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;chrono/serialization/ChArchiveJSON.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;chrono/core/ChLog.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;chrono/core/ChVector.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;chrono/core/ChMatrixDynamic.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;chrono/core/ChMatrix.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;chrono/core/ChException.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;chrono/solver/ChConstraintTuple.h&quot;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechrono.html">chrono</a>;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">enum</span> myEnum {</div><div class="line">     ATHLETIC = 0,</div><div class="line">     SKINNY = 3,</div><div class="line">     FAT</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="group__chrono__serialization.html#ga08e560ac856ac04bbd9854cf474a3afe">CH_ENUM_MAPPER_BEGIN</a>(myEnum);</div><div class="line">  CH_ENUM_VAL(ATHLETIC);</div><div class="line">  CH_ENUM_VAL(SKINNY);</div><div class="line">  CH_ENUM_VAL(FAT, <span class="stringliteral">&quot;fatty&quot;</span>);  <span class="comment">// overrides the &quot;FAT&quot; mapped string with &quot;fatty&quot;</span></div><div class="line">CH_ENUM_MAPPER_END(myEnum);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Define some example classes just for showing how CHRONO serialization</span></div><div class="line"><span class="comment">// system works, even with inheritance and versioning...</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// The statements marked with //##### are mandatory if you want to</span></div><div class="line"><span class="comment">// take advantage of basic Chrono streaming and serialization mechanisms,</span></div><div class="line"><span class="comment">// that is if you want to save/load the object to&amp;from a stream.</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// The statements marked with //***** are needed only if you want to</span></div><div class="line"><span class="comment">// take advantage of Chrono advanced serialization mechanism, that is the</span></div><div class="line"><span class="comment">// abstract class creation (class factory) which can load an</span></div><div class="line"><span class="comment">// object from stream even if the object class is not known in advance.</span></div><div class="line"><span class="comment">// This more advanced feature requires a &#39;class factory&#39; registration</span></div><div class="line"><span class="comment">// of your object type by means of the ChClassRegister&lt;&gt; statement (in</span></div><div class="line"><span class="comment">// its turn, it requires that your object has also the Chrono simulation</span></div><div class="line"><span class="comment">// of run-time-type information enabled, that is the CH_RTTI_.. macros).</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="keyword">class </span>myEmployee {</div><div class="line">    <span class="comment">// Remember to enable the Chrono RTTI features with the CH_RTTI_.. macro</span></div><div class="line">    <span class="comment">// if you want to deserialize objects whose exact class is not known in advance!</span></div><div class="line"></div><div class="line">    CH_RTTI_ROOT(myEmployee)  <span class="comment">//***** for _advanced_ Chrono serialization</span></div><div class="line"></div><div class="line">  public:</div><div class="line">    <span class="keywordtype">int</span> age;</div><div class="line">    <span class="keywordtype">double</span> wages;</div><div class="line">    myEnum body;</div><div class="line"></div><div class="line">    myEmployee(<span class="keywordtype">int</span> m_age = 18, <span class="keywordtype">double</span> m_wages = 1020.3, myEnum m_body = myEnum::ATHLETIC) : </div><div class="line">        age(m_age), </div><div class="line">        wages(m_wages),</div><div class="line">        body(m_body){};</div><div class="line"></div><div class="line">    <span class="comment">// MEMBER FUNCTIONS FOR BINARY I/O</span></div><div class="line">    <span class="comment">// NOTE!!!In order to allow serialization with Chrono approach,</span></div><div class="line">    <span class="comment">// at least implement these two functions, with the exact names</span></div><div class="line">    <span class="comment">// ArchiveIN() and ArchiveOUT():</span></div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> ArchiveOUT(<a class="code" href="classchrono_1_1_ch_archive_out.html">ChArchiveOut</a>&amp; marchive)  <span class="comment">//##### for Chrono serialization</span></div><div class="line">    {</div><div class="line">        <span class="comment">// suggested: use versioning</span></div><div class="line">        marchive.VersionWrite(1);</div><div class="line">        <span class="comment">// stream out all member data</span></div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(age);</div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(wages);</div><div class="line">        myEnum_mapper enum_map;</div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(enum_map(body), <span class="stringliteral">&quot;body&quot;</span>); <span class="comment">// note: CHNVP macro can override names used when streaming to ascii..</span></div><div class="line">    }</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> ArchiveIN(<a class="code" href="classchrono_1_1_ch_archive_in.html">ChArchiveIn</a>&amp; marchive)  <span class="comment">//##### for Chrono serialization</span></div><div class="line">    {</div><div class="line">        <span class="comment">// suggested: use versioning</span></div><div class="line">        <span class="keywordtype">int</span> version = marchive.VersionRead();</div><div class="line">        <span class="comment">// stream in all member data</span></div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(age);</div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(wages);</div><div class="line">        myEnum_mapper enum_map;</div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(enum_map(body), <span class="stringliteral">&quot;body&quot;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">};</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Somewhere in your cpp code (not in .h headers!) you should put the</span></div><div class="line"><span class="comment">// &#39;class factory&#39; registration of your class, assuming it has the CH_RTTI_..,</span></div><div class="line"><span class="comment">// if you want to use the AbstractReadCreate() feature, to deserialize</span></div><div class="line"><span class="comment">// objects whose exact class is not known in advance.</span></div><div class="line"></div><div class="line"><a class="code" href="classchrono_1_1_ch_class_register.html">chrono::ChClassRegister&lt;myEmployee&gt;</a> a_registration1;  <span class="comment">//***** for _advanced_ Chrono serialization</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Ok, now let&#39;s do something even more difficult: an inherited class.</span></div><div class="line"><span class="comment">// Note the CH_RTTI macro. </span></div><div class="line"></div><div class="line"><span class="keyword">class </span>myEmployeeBoss : <span class="keyword">public</span> myEmployee {</div><div class="line">    CH_RTTI(myEmployeeBoss, myEmployee)  <span class="comment">//***** for _advanced_ Chrono serialization</span></div><div class="line"></div><div class="line">  public:</div><div class="line">    <span class="keywordtype">bool</span> is_dumb;</div><div class="line">    myEmployee slave;</div><div class="line"></div><div class="line"></div><div class="line">    myEmployeeBoss(<span class="keywordtype">int</span> m_age = 38, <span class="keywordtype">double</span> m_wages = 9000.4, <span class="keywordtype">bool</span> m_is_dumb = true)</div><div class="line">        : myEmployee(m_age, m_wages), </div><div class="line">        is_dumb(m_is_dumb),</div><div class="line">        slave(21, 300){};</div><div class="line"></div><div class="line">    <span class="comment">// MEMBER FUNCTIONS FOR BINARY I/O</span></div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> ArchiveOUT(<a class="code" href="classchrono_1_1_ch_archive_out.html">ChArchiveOut</a>&amp; marchive)  <span class="comment">//##### for Chrono serialization</span></div><div class="line">    {</div><div class="line">        <span class="comment">// suggested: use versioning</span></div><div class="line">        marchive.VersionWrite(2);</div><div class="line">        <span class="comment">// remember to serialize the parent class data too!!!</span></div><div class="line">        myEmployee::ArchiveOUT(marchive);</div><div class="line"></div><div class="line">        <span class="comment">// stream out member data</span></div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(is_dumb);</div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(slave);  <span class="comment">// this added only from version &gt;1</span></div><div class="line">    }</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> ArchiveIN(<a class="code" href="classchrono_1_1_ch_archive_in.html">ChArchiveIn</a>&amp; marchive)  <span class="comment">//##### for Chrono serialization</span></div><div class="line">    {</div><div class="line">        <span class="comment">// suggested: use versioning</span></div><div class="line">        <span class="keywordtype">int</span> version = marchive.VersionRead();</div><div class="line">        <span class="comment">// remember to deserialize the parent class data too!!!</span></div><div class="line">        myEmployee::ArchiveIN(marchive);</div><div class="line"></div><div class="line">        <span class="comment">// stream in member data</span></div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(is_dumb);</div><div class="line">        <span class="keywordflow">if</span> (version &gt; 1){</div><div class="line">            marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(slave);  <span class="comment">// this added only from version &gt;1</span></div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="classchrono_1_1_ch_class_register.html">chrono::ChClassRegister&lt;myEmployeeBoss&gt;</a> a_registration2;  <span class="comment">//***** for _advanced_ Chrono serialization</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Example on how to serialize OUT some data:</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> my_serialization_example(<a class="code" href="classchrono_1_1_ch_archive_out.html">ChArchiveOut</a>&amp; marchive)</div><div class="line">{</div><div class="line">        <span class="comment">// All basic primitives (strings, int,etc.), plus and objects that has</span></div><div class="line">        <span class="comment">// an ArchiveOUT() function defined can be serialized in archives.      </span></div><div class="line"></div><div class="line">        <span class="comment">// Write from transient data into persistent binary file</span></div><div class="line">        <span class="keywordtype">double</span> m_double = 0.123456;</div><div class="line">        <span class="keywordtype">int</span> m_int = -123;</div><div class="line">        <span class="keywordtype">double</span> m_array[] = {13.1, 15.3, 16.5};</div><div class="line">        <span class="keywordtype">char</span> m_text[] = <span class="stringliteral">&quot;test string&quot;</span>; <span class="comment">// better use std::string</span></div><div class="line">        std::string m_string = <span class="stringliteral">&quot;hey! stl string&quot;</span>;</div><div class="line">        std::vector&lt; double &gt; m_stlvector; </div><div class="line">        m_stlvector.push_back (2.3); </div><div class="line">        m_stlvector.push_back (45.3);</div><div class="line">        m_stlvector.push_back (66.44);</div><div class="line">        std::list&lt; ChVector&lt;&gt; &gt; m_stllist; </div><div class="line">        m_stllist.push_back ( ChVector&lt;&gt;(1,2,3) ); </div><div class="line">        m_stllist.push_back ( ChVector&lt;&gt;(3,4,5) );</div><div class="line">        <a class="code" href="classchrono_1_1_ch_matrix_dynamic.html">ChMatrixDynamic&lt;double&gt;</a> m_matr(3, 5);</div><div class="line">        m_matr.<a class="code" href="classchrono_1_1_ch_matrix.html#aed55971506506c1dc21f822bd451fc72">FillRandom</a>(10, 0);</div><div class="line">        ChVector&lt;&gt; m_vect(0.5, 0.6, 0.7);</div><div class="line">        <a class="code" href="classchrono_1_1_ch_quaternion.html">ChQuaternion&lt;&gt;</a> m_quat(0.1, 0.2, 0.3, 0.4);  </div><div class="line">   </div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_double,<span class="stringliteral">&quot;custom double&quot;</span>);  <span class="comment">// store data n.1      </span></div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_int);     <span class="comment">// store data n.2 </span></div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_array);   <span class="comment">// store data n.3</span></div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_text);    <span class="comment">// store data n....</span></div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_string);  </div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_stlvector);</div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_stllist);</div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_matr);    </div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_vect);</div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_quat, <span class="stringliteral">&quot;m_quaternion&quot;</span>, NVP_TRACK_OBJECT);  </div><div class="line">        </div><div class="line">        <span class="comment">// Also store a c++ object </span></div><div class="line">        <span class="comment">// In order to use this feature, the classes must implement </span></div><div class="line">        <span class="comment">// ArchiveIN and ArchiveOUT functions.</span></div><div class="line">        myEmployeeBoss m_boss(53, 12000.34, <span class="keyword">true</span>);</div><div class="line">        m_boss.body = FAT;</div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_boss);    </div><div class="line"></div><div class="line">        <span class="comment">// Also store a c++ objects referenced by pointer(s).</span></div><div class="line">        <span class="comment">// One could have multiple pointers to the same object: </span></div><div class="line">        <span class="comment">// the serialization of pointers takes care of redundancy.</span></div><div class="line">        <span class="comment">// In order to use this feature, the classes must implement </span></div><div class="line">        <span class="comment">// ArchiveIN and ArchiveOUT functions.</span></div><div class="line">        ChVector&lt;&gt;* a_vect = <span class="keyword">new</span> ChVector&lt;&gt;(1,2,3); </div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(a_vect);</div><div class="line">        <span class="keyword">delete</span> a_vect;</div><div class="line"></div><div class="line">        <span class="comment">// Null pointers can be serialized. They will be deserialized as null.</span></div><div class="line">        ChVector&lt;&gt;* a_null_ptr = 0; </div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(a_null_ptr);</div><div class="line"></div><div class="line">        <span class="comment">// Also store c++ objects referenced by pointer, using the</span></div><div class="line">        <span class="comment">// class abstraction (class factory) mechanism, so that it</span></div><div class="line">        <span class="comment">// can be loaded later even if we do not know if it was an object of</span></div><div class="line">        <span class="comment">// class &#39;myEmployee&#39; or specialized class &#39;myEmployeeBoss&#39;...</span></div><div class="line">        <span class="comment">// In order to use this feature, the classes must implement </span></div><div class="line">        <span class="comment">// CH_RTTI_ROOT or CH_RTTI functions and ArchiveIN and ArchiveOUT</span></div><div class="line">        myEmployeeBoss* a_boss = <span class="keyword">new</span> myEmployeeBoss(64, 22356, <span class="keyword">false</span>);</div><div class="line">        a_boss-&gt;slave.age = 24;</div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(a_boss);  <span class="comment">//  object was referenced by pointer.</span></div><div class="line"></div><div class="line">        <span class="comment">// If another pointer shares the same object instance, you can serialize</span></div><div class="line">        <span class="comment">// it too without worrying, because the serialization system will save only</span></div><div class="line">        <span class="comment">// the first copy and following copies will just use references.</span></div><div class="line"></div><div class="line">        myEmployeeBoss* a_boss2 = a_boss;</div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(a_boss2);  <span class="comment">//  object was referenced by pointer.</span></div><div class="line"></div><div class="line">        <span class="comment">// Also store c++ objects referenced by shared pointers.</span></div><div class="line">        <span class="comment">// If pointed objects objects have CH_RTTI, the class abstraction</span></div><div class="line">        <span class="comment">// vill be automatically used.</span></div><div class="line">        <span class="keyword">auto</span> s_boss = std::make_shared&lt;myEmployeeBoss&gt;();</div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(s_boss);  <span class="comment">//  object was referenced by shared pointer.</span></div><div class="line"></div><div class="line">        <span class="comment">// Serialize null shared pointer</span></div><div class="line">        std::shared_ptr&lt;myEmployeeBoss&gt; null_boss;</div><div class="line">        marchive &lt;&lt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(null_boss); </div><div class="line"></div><div class="line">        <span class="keyword">delete</span> a_boss;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Example on how to deserialize IN some data:</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> my_deserialization_example(<a class="code" href="classchrono_1_1_ch_archive_in.html">ChArchiveIn</a>&amp; marchive)</div><div class="line">{  </div><div class="line">        <span class="comment">// Read from persistent binary file to transient data</span></div><div class="line">        <span class="keywordtype">double</span> m_double;</div><div class="line">        <span class="keywordtype">int</span> m_int;</div><div class="line">        <span class="keywordtype">double</span> m_array[3];</div><div class="line">        <span class="keywordtype">char</span> m_text[12]; <span class="comment">// better use std::string</span></div><div class="line">        std::string m_string;</div><div class="line">        std::vector&lt; double &gt; m_stlvector;</div><div class="line">        std::list&lt; ChVector&lt;&gt; &gt; m_stllist;</div><div class="line">        <a class="code" href="classchrono_1_1_ch_matrix_dynamic.html">ChMatrixDynamic&lt;&gt;</a> m_matr;</div><div class="line">        ChVector&lt;&gt; m_vect;</div><div class="line">        <a class="code" href="classchrono_1_1_ch_quaternion.html">ChQuaternion&lt;&gt;</a> m_quat;</div><div class="line">        myEmployeeBoss m_boss;</div><div class="line">        ChVector&lt;&gt;* a_vect;</div><div class="line">        ChVector&lt;&gt;* a_null_ptr;</div><div class="line"></div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_double,<span class="stringliteral">&quot;custom double&quot;</span>);  <span class="comment">// deserialize data n.1</span></div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_int);     <span class="comment">// deserialize data n.2</span></div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_array);   <span class="comment">// deserialize data n.3</span></div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_text);    <span class="comment">// deserialize data n....</span></div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_string);  </div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_stlvector);</div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_stllist);</div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_matr);</div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_vect);  </div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_quat, <span class="stringliteral">&quot;m_quaternion&quot;</span>, NVP_TRACK_OBJECT);        </div><div class="line"></div><div class="line">        <span class="comment">// Also deserialize the C++ object</span></div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(m_boss); </div><div class="line"></div><div class="line">        <span class="comment">// Also deserialize the C++ pointer: an object will be created!</span></div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(a_vect); </div><div class="line"></div><div class="line">        <span class="comment">// Also deserialize the null C++ pointer: no object is created, and pointer set as null.</span></div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(a_null_ptr);</div><div class="line"></div><div class="line">        <span class="comment">// Also retrieve c++ objects, referenced by a base class pointer, using the</span></div><div class="line">        <span class="comment">// class abstraction (class factory) mechanism, so that it</span></div><div class="line">        <span class="comment">// can be loaded even if we do not know if it was an object of</span></div><div class="line">        <span class="comment">// the base class &#39;myEmployee&#39; or the specialized &#39;myEmployeeBoss&#39; class..</span></div><div class="line">        myEmployee* a_boss = 0;</div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(a_boss);  <span class="comment">// object will be created</span></div><div class="line"></div><div class="line">        <span class="comment">// Since the two pointers a_boss and a_boss2 were serialized when pointing to </span></div><div class="line">        <span class="comment">// the same object instance, now the following will Not create another copy but will</span></div><div class="line">        <span class="comment">// automatically point to the same object of a_boss. </span></div><div class="line">        myEmployee* a_boss2 = 0;</div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(a_boss2); </div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// Also store c++ objects referenced by shared pointers.</span></div><div class="line">        <span class="comment">// If pointed objects objects have CH_RTTI, the class abstraction</span></div><div class="line">        <span class="comment">// will be automatically used.</span></div><div class="line">        std::shared_ptr&lt;myEmployeeBoss&gt; s_boss(0);</div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(s_boss);</div><div class="line"></div><div class="line">        <span class="comment">// Deserialize a null shared pointer</span></div><div class="line">        std::shared_ptr&lt;myEmployeeBoss&gt; null_boss(0);</div><div class="line">        marchive &gt;&gt; <a class="code" href="group__chrono__serialization.html#ga031b244b9f00c13f431aa6df785b63c7">CHNVP</a>(null_boss);</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// Just for safety, log some of the restored data:</span></div><div class="line"></div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;\n\nResult of deserialization I/O: \n &quot;</span> &lt;&lt; m_text &lt;&lt; <span class="stringliteral">&quot; \n &quot;</span> &lt;&lt; m_int &lt;&lt; <span class="stringliteral">&quot; \n &quot;</span> &lt;&lt; m_double &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; m_matr;</div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; m_vect;</div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; m_quat;</div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; m_string.c_str() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; m_stlvector;</div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; m_boss;</div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; a_vect;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (a_boss) {</div><div class="line">            <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;\n\n We loaded an obj inherited from myEmployee class:\n&quot;</span>;</div><div class="line">            <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; *a_boss;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (a_boss2) {</div><div class="line">            <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;\n\n We loaded a 2nd obj inherited from myEmployee class (referencing the 1st):\n&quot;</span>;</div><div class="line">            <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; *a_boss2;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (s_boss) {</div><div class="line">            <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;\n\n We loaded a 3nd obj inherited from myEmployee class:\n&quot;</span>;</div><div class="line">            <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; *(s_boss);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (!null_boss) {</div><div class="line">            <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;\n\n We tried to load a 4th obj with shared pointer, but was null.\n&quot;</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">            <span class="comment">// By the way, now show some feaures of Chrono run-time-type-identifier</span></div><div class="line">            <span class="comment">// methods, since class had CH_RTTI enabled.</span></div><div class="line">            <span class="comment">// Note that Chrono RTTI is _not_ the standard C++ RTTI! Also, it</span></div><div class="line">            <span class="comment">// does not need RTTI to be enabled in compilation. It is platform-</span></div><div class="line">            <span class="comment">// and compiler-independent.</span></div><div class="line">            <span class="comment">// The only drawback of Chrono RTTI is that it is a bit slower than</span></div><div class="line">            <span class="comment">// standard C++ RTTI, and it introduces a virtual method in the class (not a</span></div><div class="line">            <span class="comment">// big problem however, since also C++ RTTI eats some memory...)</span></div><div class="line"></div><div class="line">            <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">            <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;loaded object is a myEmployee?     :&quot;</span> &lt;&lt; ChIsExactlyClass(myEmployee, a_boss) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">            <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;loaded object is a myEmployeeBoss? :&quot;</span> &lt;&lt; ChIsExactlyClass(myEmployeeBoss, a_boss) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">            <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;loaded object derives myEmployee?  :&quot;</span> &lt;&lt; ChIsDerivedFromClass(myEmployee, a_boss) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">            <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;Obvious! we loaded an object of class: &quot;</span> &lt;&lt; a_boss-&gt;GetRTTI()-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">            <span class="keyword">delete</span> a_boss;</div><div class="line">        }</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) {</div><div class="line"></div><div class="line">    <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line">             &lt;&lt; <span class="stringliteral">&quot;CHRONO foundation classes demo: archives (serialization)\n\n&quot;</span>;</div><div class="line"></div><div class="line">    </div><div class="line">    <span class="comment">//  Archives inherited from the base class ChArchiveOut can be</span></div><div class="line">    <span class="comment">// used to serialize objects, and streams inherited from ChArchiveIn</span></div><div class="line">    <span class="comment">// can be used to get them back. For example, file streams like</span></div><div class="line">    <span class="comment">// ChArchiveOutBinary and ChArchiveInBinary can be used for this</span></div><div class="line">    <span class="comment">// purpose.</span></div><div class="line">    </div><div class="line">    <span class="keywordflow">try</span> {       </div><div class="line">        </div><div class="line">        {</div><div class="line">            <span class="comment">//</span></div><div class="line">            <span class="comment">// Example: SERIALIZE TO ASCII DUMP (useful for debugging etc.):</span></div><div class="line">            <span class="comment">//</span></div><div class="line"></div><div class="line">        </div><div class="line">            <a class="code" href="classchrono_1_1_ch_stream_out_ascii_file.html">ChStreamOutAsciiFile</a> mfileo(<span class="stringliteral">&quot;foo_archive.txt&quot;</span>);</div><div class="line"></div><div class="line">            <span class="comment">// Create a binary archive, that uses the binary file as storage.</span></div><div class="line">            <a class="code" href="classchrono_1_1_ch_archive_ascii_dump.html">ChArchiveAsciiDump</a> marchiveout(mfileo);</div><div class="line">        </div><div class="line">            my_serialization_example(marchiveout);</div><div class="line">        }</div><div class="line"></div><div class="line"></div><div class="line">        {</div><div class="line">            <span class="comment">//</span></div><div class="line">            <span class="comment">// Example: SERIALIZE TO/FROM BINARY:</span></div><div class="line">            <span class="comment">//</span></div><div class="line"></div><div class="line">            {</div><div class="line">                <a class="code" href="classchrono_1_1_ch_stream_out_binary_file.html">ChStreamOutBinaryFile</a> mfileo(<span class="stringliteral">&quot;foo_archive.dat&quot;</span>);</div><div class="line"></div><div class="line">                <span class="comment">// Create a binary archive, that uses the binary file as storage.</span></div><div class="line">                <a class="code" href="classchrono_1_1_ch_archive_out_binary.html">ChArchiveOutBinary</a> marchiveout(mfileo);</div><div class="line">        </div><div class="line">                my_serialization_example(marchiveout);</div><div class="line">            }</div><div class="line"></div><div class="line">            {</div><div class="line">                <a class="code" href="classchrono_1_1_ch_stream_in_binary_file.html">ChStreamInBinaryFile</a> mfilei(<span class="stringliteral">&quot;foo_archive.dat&quot;</span>);</div><div class="line"></div><div class="line">                <span class="comment">// Create a binary archive, that uses the binary file as storage.</span></div><div class="line">                <a class="code" href="classchrono_1_1_ch_archive_in_binary.html">ChArchiveInBinary</a> marchivein(mfilei);</div><div class="line"></div><div class="line">                 my_deserialization_example(marchivein);</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line"></div><div class="line">        {</div><div class="line">            <span class="comment">//</span></div><div class="line">            <span class="comment">// Example: SERIALIZE TO/FROM JSON:</span></div><div class="line">            <span class="comment">//</span></div><div class="line"></div><div class="line">            {</div><div class="line">                <a class="code" href="classchrono_1_1_ch_stream_out_ascii_file.html">ChStreamOutAsciiFile</a> mfileo(<span class="stringliteral">&quot;foo_archive.json&quot;</span>);</div><div class="line"></div><div class="line">                <span class="comment">// Create a binary archive, that uses the binary file as storage.</span></div><div class="line">                <a class="code" href="classchrono_1_1_ch_archive_out_j_s_o_n.html">ChArchiveOutJSON</a> marchiveout(mfileo);</div><div class="line">        </div><div class="line">                my_serialization_example(marchiveout);</div><div class="line">            }</div><div class="line"></div><div class="line">            </div><div class="line">            {</div><div class="line">                <a class="code" href="classchrono_1_1_ch_stream_in_ascii_file.html">ChStreamInAsciiFile</a> mfilei(<span class="stringliteral">&quot;foo_archive.json&quot;</span>);</div><div class="line"></div><div class="line">                <span class="comment">// Create a binary archive, that uses the binary file as storage.</span></div><div class="line">                <a class="code" href="classchrono_1_1_ch_archive_in_j_s_o_n.html">ChArchiveInJSON</a> marchivein(mfilei);</div><div class="line"></div><div class="line">                my_deserialization_example(marchivein);</div><div class="line">            }</div><div class="line">            </div><div class="line">        }</div><div class="line"> </div><div class="line"></div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;Serialization test ended with success.\n&quot;</span>;</div><div class="line"></div><div class="line">    } <span class="keywordflow">catch</span> (<a class="code" href="classchrono_1_1_ch_exception.html">ChException</a> myex) {</div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;ERROR: &quot;</span> &lt;&lt; myex.what() &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>Tutorial on streams, such as files. Learn how to write to streams and files and read from them.</p>
<p>No GUI: only text output.</p>
<div class="fragment"><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// PROJECT CHRONO - http://projectchrono.org</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Copyright (c) 2010 Alessandro Tasora</span></div><div class="line"><span class="comment">// All rights reserved.</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Use of this source code is governed by a BSD-style license that can be</span></div><div class="line"><span class="comment">// found in the LICENSE file at the top level of the distribution</span></div><div class="line"><span class="comment">// and at http://projectchrono.org/license-chrono.txt.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//   Demos code about</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//     - streams,</span></div><div class="line"><span class="comment">//     - serialization, with versioning and dynamic</span></div><div class="line"><span class="comment">//       creation (class factory)</span></div><div class="line"><span class="comment">//     - class runtime type identification, without</span></div><div class="line"><span class="comment">//       enabling the RTTI compiler feature</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//       CHRONO</span></div><div class="line"><span class="comment">//   ------</span></div><div class="line"><span class="comment">//   Multibody dinamics engine</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// ------------------------------------------------</span></div><div class="line"><span class="comment">//             http://www.projectchrono.org</span></div><div class="line"><span class="comment">// ------------------------------------------------</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;chrono/core/ChLog.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;chrono/core/ChMatrix.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;chrono/core/ChMatrixDynamic.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;chrono/core/ChVector.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;chrono/core/ChClassRegister.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;chrono/core/ChException.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechrono.html">chrono</a>;</div><div class="line"></div><div class="line"><span class="comment">// NOTE: the old serialization method, based on ChStream and StreamIN and StreamOUT methods </span></div><div class="line"><span class="comment">// has been replaced with the new serialization based on ChArchive and ArchiveIN and ArchiveOUT methods,</span></div><div class="line"><span class="comment">// so if you are interested on object serialization look rather at </span></div><div class="line"><span class="comment">//   demo_archive.cpp </span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) {</div><div class="line">    <span class="comment">// To write something to the console, use the chrono::GetLog()</span></div><div class="line">    <span class="comment">// statement, which returns a global output stream to the console (just</span></div><div class="line">    <span class="comment">// like the std::out stream).</span></div><div class="line">    <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line">             &lt;&lt; <span class="stringliteral">&quot;CHRONO foundation classes demo: streaming and serialization\n\n&quot;</span>;</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     *  TEST SOME BASIC FILE I/O , AS ASCII FILE WRITE/SAVE</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     */</span></div><div class="line"></div><div class="line">    <span class="comment">// Chrono stream classes use exceptions for error handling,</span></div><div class="line">    <span class="comment">// so you should use the try-catch mechanism.</span></div><div class="line">    <span class="comment">// Exceptions thrown are of class ChException.</span></div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        <span class="comment">// Open a file of class &quot;ChStreamOutAsciiFile&quot; for writing ascii</span></div><div class="line">        <a class="code" href="classchrono_1_1_ch_stream_out_ascii_file.html">ChStreamOutAsciiFile</a> mfileo(<span class="stringliteral">&quot;foo_file.txt&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">// Write some items, space-separated, inside the ascii file.</span></div><div class="line">        <span class="comment">// The class ChStreamOutAsciiFile implements the &lt;&lt; operator for most</span></div><div class="line">        <span class="comment">// basic types (double, int, string, etc.).</span></div><div class="line">        mfileo &lt;&lt; <span class="stringliteral">&quot;test_token&quot;</span></div><div class="line">               &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; 123 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; 0.123437;</div><div class="line"></div><div class="line">    } <span class="keywordflow">catch</span> (<a class="code" href="classchrono_1_1_ch_exception.html">ChException</a> myex) {</div><div class="line">        <span class="comment">// Ops.. file could not be opened or written.. echo what happened!</span></div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;ERROR: &quot;</span> &lt;&lt; myex.what();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Ok, you wrote something in your pollo_file.txt file,</span></div><div class="line">    <span class="comment">// so now try to load from it...</span></div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        <span class="comment">// Open a file for reading ascii: the ChStreamInAsciiFile has</span></div><div class="line">        <span class="comment">// some minimal parsing capabilities...</span></div><div class="line">        <a class="code" href="classchrono_1_1_ch_stream_in_ascii_file.html">ChStreamInAsciiFile</a> mfilei(<span class="stringliteral">&quot;foo_file.txt&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">// Try to load some text tokens and convert them (at least each token</span></div><div class="line">        <span class="comment">// separated by space or linefeed..)</span></div><div class="line">        <span class="keywordtype">char</span> sbuff[200];</div><div class="line">        <span class="keywordtype">int</span> mint;</div><div class="line">        <span class="keywordtype">double</span> mdouble;</div><div class="line">        mfilei &gt;&gt; sbuff &gt;&gt; mint &gt;&gt; mdouble;</div><div class="line"></div><div class="line">        <span class="comment">// Write to the console the values which have been read from file..</span></div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;\nResult of ascii  I/O:  &quot;</span> &lt;&lt; sbuff &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; mint &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; mdouble &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"></div><div class="line">    } <span class="keywordflow">catch</span> (<a class="code" href="classchrono_1_1_ch_exception.html">ChException</a> myex) {</div><div class="line">        <span class="comment">// Ops.. file could not be opened or read.. echo what happened!</span></div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;ERROR: &quot;</span> &lt;&lt; myex.what();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     *  TEST BINARY STREAMING</span></div><div class="line"><span class="comment">     */</span></div><div class="line"></div><div class="line">    <span class="comment">//  Streams inherited from the base class ChStreamOutBinary can be</span></div><div class="line">    <span class="comment">// used to serialize, and streams inherited from ChStreamInBinary</span></div><div class="line">    <span class="comment">// can be used to get them back. For example, file streams like</span></div><div class="line">    <span class="comment">// ChStreamOutBinaryFile and ChStreamInBinaryFile can be used for this</span></div><div class="line">    <span class="comment">// purpose.</span></div><div class="line">    <span class="comment">//  All basic primitives (strings, int,etc.) and objects implementing the &lt;&lt;</span></div><div class="line">    <span class="comment">// operator can be streamed into ChStreamOutBinary streams like in the</span></div><div class="line">    <span class="comment">// following example.</span></div><div class="line"></div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        <span class="comment">// Open a file of class &quot;ChStreamOutBinaryFile&quot; for serializing</span></div><div class="line">        <a class="code" href="classchrono_1_1_ch_stream_out_binary_file.html">ChStreamOutBinaryFile</a> mfileo(<span class="stringliteral">&quot;foo_archive.dat&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">// Write from transient data into persistent binary file</span></div><div class="line">        <span class="keywordtype">char</span> m_text[] = <span class="stringliteral">&quot;foo_string&quot;</span>;</div><div class="line">        <span class="keywordtype">double</span> m_double = 5.7766;</div><div class="line">        <span class="keywordtype">int</span> m_int = -348;</div><div class="line">        std::string m_string = <span class="stringliteral">&quot;hey! stl string&quot;</span>;</div><div class="line"></div><div class="line">        mfileo &lt;&lt; m_text;    <span class="comment">// store data n.1</span></div><div class="line">        mfileo &lt;&lt; m_double;  <span class="comment">// store data n.2</span></div><div class="line">        mfileo &lt;&lt; m_int;     <span class="comment">// store data n.3</span></div><div class="line">        mfileo &lt;&lt; m_string;  <span class="comment">// store data n.4</span></div><div class="line"></div><div class="line">    } <span class="keywordflow">catch</span> (<a class="code" href="classchrono_1_1_ch_exception.html">ChException</a> myex) {</div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;ERROR: &quot;</span> &lt;&lt; myex.what();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Well, now try to load data back, to see if things worked ok...</span></div><div class="line"></div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        <span class="comment">// Open a file of class &quot;ChStreamOutBinaryFile&quot; for deserializing</span></div><div class="line">        <a class="code" href="classchrono_1_1_ch_stream_in_binary_file.html">ChStreamInBinaryFile</a> mfilei(<span class="stringliteral">&quot;foo_archive.dat&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">// Read from persistent binary file to transient data</span></div><div class="line">        <span class="keywordtype">char</span> m_text[200];</div><div class="line">        <span class="keywordtype">int</span> m_int;</div><div class="line">        <span class="keywordtype">double</span> m_double;</div><div class="line">        std::string m_string;</div><div class="line"></div><div class="line">        mfilei &gt;&gt; m_text;    <span class="comment">// retrieve data n.1</span></div><div class="line">        mfilei &gt;&gt; m_double;  <span class="comment">// retrieve data n.2</span></div><div class="line">        mfilei &gt;&gt; m_int;     <span class="comment">// retrieve data n.3</span></div><div class="line">        mfilei &gt;&gt; m_string;  <span class="comment">// retrieve data n.4</span></div><div class="line"></div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;\nResult of binary I/O: &quot;</span> &lt;&lt; m_text &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; m_int &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; m_double &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">        </div><div class="line">    } <span class="keywordflow">catch</span> (<a class="code" href="classchrono_1_1_ch_exception.html">ChException</a> myex) {</div><div class="line">        <span class="comment">// Ops.. file could not be opened or read.. echo what happened!</span></div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;ERROR: &quot;</span> &lt;&lt; myex.what();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     *  TEST std:: STREAM WRAPPING</span></div><div class="line"><span class="comment">     */</span></div><div class="line"></div><div class="line">    <span class="comment">// In the previous examples we showed how to use Chrono::Engine</span></div><div class="line">    <span class="comment">// file streams such as  ChStreamInBinaryFile and ChStreamOutBinaryFile,</span></div><div class="line">    <span class="comment">// but in the following we show that we can also wrap whatever object</span></div><div class="line">    <span class="comment">// of type std::istream or std::ostream (already opened files, string streams,</span></div><div class="line">    <span class="comment">// console logs, etc), thank to ChStreamOutBinaryStream and</span></div><div class="line">    <span class="comment">// ChStreamInBinaryStream. All the concepts learned until now, such as</span></div><div class="line">    <span class="comment">// serialization through &lt;&lt; and &gt;&gt; , are still possible.</span></div><div class="line"></div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        std::stringstream mstream;</div><div class="line"></div><div class="line">        <a class="code" href="classchrono_1_1_ch_stream_out_binary_stream.html">ChStreamOutBinaryStream</a> mchstreamo(&amp;mstream);</div><div class="line">        <span class="keywordtype">double</span> md_out = 12.5;</div><div class="line">        mchstreamo &lt;&lt; md_out;</div><div class="line"></div><div class="line">        <span class="keywordtype">double</span> md_in;</div><div class="line">        <a class="code" href="classchrono_1_1_ch_stream_in_binary_stream.html">ChStreamInBinaryStream</a> mchstreami(&amp;mstream);</div><div class="line">        mchstreami &gt;&gt; md_in;</div><div class="line"></div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;\nResult of binary I/O from wrapped std::stream: &quot;</span> &lt;&lt; md_in &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"></div><div class="line">    } <span class="keywordflow">catch</span> (<a class="code" href="classchrono_1_1_ch_exception.html">ChException</a> myex) {</div><div class="line">        <span class="comment">// Ops.. some error.. echo what happened!</span></div><div class="line">        <a class="code" href="namespacechrono.html#a4fba60cf9a29db628ad96a88b60b4e00">GetLog</a>() &lt;&lt; <span class="stringliteral">&quot;ERROR: &quot;</span> &lt;&lt; myex.what();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 1 2016 15:43:10 for Project Chrono by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11 . <a href="mailto:info@projectchrono.org">Contact us</a> for issues related to this page. 
</small></address>
</body>
</html>
