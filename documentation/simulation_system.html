<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- For Mobile Devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta name="generator" content="Doxygen 1.8.11"/>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <link rel="stylesheet" href='http://fonts.googleapis.com/css?family=Exo+2:400,200,700' type='text/css'>
    <title>Project Chrono: Simulation system</title>
    <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
    <script type="text/javascript" src="dynsections.js"></script>
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
    <link href="main.css" rel="stylesheet" type="text/css" />
    <!--  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css"> -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="doxy-boot.js"></script>
    <script type="text/javascript" src="bootstrap-hover-dropdown.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://projectchrono.org">
            <span class="logo first">PROJECT</span><span class="logo second">CHRONO</span>
        </a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="http://projectchrono.org/download">Download</a></li>
        <li class="dropdown">
            <a href="http://api.chrono.projectchrono.org" class="dropdown-toggle disabled" data-hover="dropdown" data-toggle="dropdown" data-delay="100" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="http://api.chrono.projectchrono.org/faq_root.html">FAQ</a></li>
                <li><a href="http://api.chrono.projectchrono.org/tutorial_table_of_content_install.html">Install Guide</a></li>
                <li><a href="http://api.chrono.projectchrono.org/tutorial_root.html">Examples/Tutorials</a></li>
                <li><a href="http://api.chrono.projectchrono.org/model_root.html">Model Library</a></li>
                <li><a href="http://api.chrono.projectchrono.org/validation_studies_root.html">Validation Studies</a></li>
                <li><a href="http://api.chrono.projectchrono.org/whitepaper_root.html">White Papers</a></li>
                <li><a href="http://projectchrono.org/docpdf">PDF Version</a></li>
            </ul>
        </li>
        <li class="dropdown">
            <a href="http://projectchrono.org/gallery/" class="dropdown-toggle disabled" data-hover="dropdown" data-toggle="dropdown" data-delay="100" role="button" style="dropdown:hover" aria-haspopup="true" aria-expanded="false">Movies <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="http://projectchrono.org/gallery/">Gallery</a></li>
                <li><a href="http://sbel.wisc.edu/Animations/">SBEL</a></li>
                <li><a href="https://vimeo.com/uwsbel">On Vimeo</a></li>
            </ul>
        </li>
        <li><a href="http://projectchrono.org/news/">News</a></li>
        <li><a href="http://projectchrono.org/forum">Forum</a></li>
		<li class="dropdown">
            <a href="http://projectchrono.org/about/" class="dropdown-toggle disabled" data-hover="dropdown" data-toggle="dropdown" data-delay="100" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="http://projectchrono.org/about/">What is ProjectChrono</a></li>
                <li><a href="http://projectchrono.org/testimonials/">Users</a></li>
            </ul>
        </li>
        <li><a href="http://projectchrono.org/status">Status</a></li>            
            <li>
              <form method="get" action="http://projectchrono.org/search" id="search_bar_triggered">
                          <input type="submit" value="Search">
                <input type="text" id="search_bar" name="query" value="" />
              </form> 
            </li>
    </ul>
          <!-- <ul class="nav navbar-nav navbar-right">
      </ul> -->
  </div><!--/.navbar-collapse -->
</div>
</nav>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div class="content" id="content">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 panel panel-default" style="padding-bottom: 15px;">
                    <div style="margin-bottom: 15px;">
                        <!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Project Chrono API/SDK documentation</a></li><li class="navelem"><a class="el" href="manual_root.html">Reference Manual</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Simulation system </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Chrono system contains all other objects being simulated, e.g.: <a class="el" href="rigid_bodies.html">bodies</a>, <a class="el" href="links.html">links</a>, etc. The system is the cornerstone of a Chrono simulation.</p>
<h1><a class="anchor" id="manual_ChSystem"></a>
ChSystem</h1>
<p>A Chrono simulation system is an object of class ChSystem. See <a class="el" href="classchrono_1_1_ch_system.html">chrono::ChSystem</a> for API details.</p>
<p>Example: The following picture shows how mechanisms turn into a database of bodies and links in a ChSystem:</p>
<div class="image">
<img src="pic_database.png" alt="pic_database.png"/>
</div>
<ul>
<li>A <a class="el" href="classchrono_1_1_ch_system.html">chrono::ChSystem</a> contains all items that participate in a simulation: bodies, constraints, numerical integrator type, integration tolerances, etc.</li>
<li>Use the <code>Add()</code>, <code>Remove()</code> functions to add elements to a system object</li>
</ul>
<p>Recommended way of dealing with system objects:</p>
<ul>
<li>Create a <a class="el" href="classchrono_1_1_ch_system.html">chrono::ChSystem</a></li>
<li>Add <a class="el" href="rigid_bodies.html">body</a> objects into it, see <a class="el" href="classchrono_1_1_ch_body.html">chrono::ChBody</a></li>
<li>Add <a class="el" href="links.html">link</a> objects into it, see <a class="el" href="classchrono_1_1_ch_link.html">chrono::ChLink</a></li>
<li>Adjust parameters for the time integration</li>
<li>Run a dynamics simulation of a certain length</li>
</ul>
<p>Example: a slider-crank mechanism</p>
<div class="fragment"><div class="line"><span class="comment">// 1- Create a Chrono physical system: all bodies and constraints</span></div><div class="line"><span class="comment">//    will belong to and be handled by this ChSystem object.</span></div><div class="line">ChSystem my_system;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 2- Create the rigid bodies of the slider-crank </span></div><div class="line"><span class="comment">//   (a crank, a rod, a truss), possibly setting their position/mass/inertias attributes</span></div><div class="line"></div><div class="line"><span class="comment">// ..the truss</span></div><div class="line"><span class="keyword">auto</span> my_body_A = std::make_shared&lt;ChBody&gt;();</div><div class="line">my_system.<a class="code" href="classchrono_1_1_ch_assembly.html#aeb86b4df59dc82ad4d5a969b45e159b1">AddBody</a>(my_body_A);</div><div class="line">my_body_A-&gt;SetBodyFixed(<span class="keyword">true</span>);  <span class="comment">// the truss doesn&#39;t move</span></div><div class="line"></div><div class="line"><span class="comment">// ..the crank</span></div><div class="line"><span class="keyword">auto</span> my_body_B = std::make_shared&lt;ChBody&gt;();</div><div class="line">my_system.AddBody(my_body_B);</div><div class="line">my_body_B-&gt;SetPos(ChVector&lt;&gt;(1, 0, 0));  <span class="comment">// position of COG of crank</span></div><div class="line">my_body_B-&gt;SetMass(2);</div><div class="line"></div><div class="line"><span class="comment">// ..the connecting rod</span></div><div class="line"><span class="keyword">auto</span> my_body_C = std::make_shared&lt;ChBody&gt;();</div><div class="line">my_system.AddBody(my_body_C);</div><div class="line">my_body_C-&gt;SetPos(ChVector&lt;&gt;(4, 0, 0));  <span class="comment">// position of COG of rod</span></div><div class="line">my_body_C-&gt;SetMass(3);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 3- Create constraints: the mechanical joints </span></div><div class="line"><span class="comment">//    between the rigid bodies.</span></div><div class="line"></div><div class="line"><span class="comment">// .. a revolute joint between the crank and rod</span></div><div class="line"><span class="keyword">auto</span> my_link_BC = std::make_shared&lt;ChLinkLockRevolute&gt;();</div><div class="line">my_link_BC-&gt;Initialize(my_body_B, my_body_C, ChCoordsys&lt;&gt;(ChVector&lt;&gt;(2, 0, 0)));</div><div class="line">my_system.AddLink(my_link_BC);</div><div class="line"></div><div class="line"><span class="comment">// .. a slider joint between the rod and truss</span></div><div class="line"><span class="keyword">auto</span> my_link_CA = std::make_shared&lt;ChLinkLockPointLine&gt;();</div><div class="line">my_link_CA-&gt;Initialize(my_body_C, my_body_A, ChCoordsys&lt;&gt;(ChVector&lt;&gt;(6, 0, 0)));</div><div class="line">my_system.AddLink(my_link_CA);</div><div class="line"></div><div class="line"><span class="comment">// .. an engine (motion generator) between the crank and truss</span></div><div class="line"><span class="keyword">auto</span> my_link_AB = std::make_shared&lt;ChLinkEngine&gt;();</div><div class="line">my_link_AB-&gt;Initialize(my_body_A, my_body_B, ChCoordsys&lt;&gt;(ChVector&lt;&gt;(0, 0, 0)));</div><div class="line">my_link_AB-&gt;Set_eng_mode(ChLinkEngine::ENG_MODE_SPEED);</div><div class="line"><span class="keywordflow">if</span> (<span class="keyword">auto</span> mfun = std::dynamic_pointer_cast&lt;ChFunction_Const&gt;(my_link_AB-&gt;Get_spe_funct()))</div><div class="line">        mfun-&gt;Set_yconst(CH_C_PI);  <span class="comment">// speed w=3.145 rad/sec</span></div><div class="line">my_system.AddLink(my_link_AB);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 4- Adjust settings of the integrator (optional):</span></div><div class="line">my_system.SetIntegrationType(ChSystem::INT_IMPLICIT_EULER)</div><div class="line">my_system.SetSolverType(ChSystem::SOLVER_SOR);</div><div class="line">my_system.SetMaxItersSolverSpeed(20);</div><div class="line">my_system.SetMaxItersSolverStab(20);</div><div class="line">my_system.SetMaxPenetrationRecoverySpeed(0.2);</div><div class="line">my_system.SetMinBounceSpeed(0.1);</div><div class="line"></div><div class="line"><span class="comment">// 5- Run the simulation (basic example)</span></div><div class="line"></div><div class="line"><span class="keywordflow">while</span>( my_system.GetChTime() &lt; 10 )</div><div class="line">{               </div><div class="line">        <span class="comment">// Chrono advances the state of the system via time integration</span></div><div class="line">        <span class="comment">// with a time step of 0.02</span></div><div class="line">        my_system.StepDynamics(0.02);</div><div class="line"></div><div class="line">        <span class="comment">// Draw items on screen (lines, circles, etc.) or dump data to disk </span></div><div class="line">        [..] </div><div class="line">}</div></div><!-- fragment --><p>The default simulation settings are good for real-time fast simulations with low requirements in terms of precision and with similar sizes and inertia attributes.</p>
<p>Several system settings may be adjusted to simulate more challenging scenarios. In most cases there are three areas to adjust:</p>
<ul>
<li>The <b>time stepper</b>; i.e., the time integration algorithm</li>
<li>The <b>solver</b>; i.e., the algorithm that computes accelerations and reaction forces at each time step</li>
<li>Other settings, for instance, the collision detection tolerances</li>
</ul>
<p>A primer on tuning these parameters is provided below.</p>
<h1><a class="anchor" id="time_steppers"></a>
Time steppers</h1>
<p>Time steppers, also known as <em>time integrators</em>, are used to advance the simulation. They perform numerical integration; i.e., they advance the state of the system in time.</p>
<p>Technical and theoretical details on time integration are explained in several PDF documents available on the <a class="el" href="whitepaper_root.html">white papers page</a>. For example <a href="http://projectchrono.org/assets/white_papers/integrator.pdf">this PDF</a> explains how implicit integrators are implemented in Chrono.</p>
<p>Time steppers can be changed in two ways:</p><ul>
<li>Using the <code>my_system.SetIntegrationType(...)</code> function, to choose a ready-to-use, pre-packaged time-stepper</li>
<li>Using the <code>my_system.SetTimestepper(...)</code> function, to plug in a custom time-stepper, which is user-defined</li>
</ul>
<p>Example: changing the time stepper to an implicit numerical integrator</p>
<div class="fragment"><div class="line">my_system.SetIntegrationType(ChSystem::INT_IMPLICIT_EULER)</div></div><!-- fragment --><p>Summary of time-steppers:</p>
<ul>
<li><code>INT_EULER_IMPLICIT_LINEARIZED</code><ul>
<li>Default time stepper in Chrono</li>
<li>Fast, no sub-iterations required</li>
<li>First order accuracy</li>
<li>Works for DVI contacts (hard contacts)</li>
<li>Delivers first order accuracy for FEA</li>
<li>Constraints kept closed using stabilization</li>
</ul>
</li>
<li><code>INT_HHT</code><ul>
<li>Implicit integrator, based on the Hilber-Hughes-Taylor formula</li>
<li>Typically slower than the INT_EULER_IMPLICIT_LINEARIZED choice</li>
<li>Sub-iterations required</li>
<li>Second order accuracy, with adjustable numerical damping</li>
<li>Currently can't be used for systems that handle contacts in a DVI approach; i.e., for hard contacts</li>
<li>Delivers second order accuracy for FEA</li>
<li>Constraints kept closed <em>exactly</em> because of inner iterations.</li>
</ul>
</li>
<li><code>INT_NEWMARK</code><ul>
<li><p class="startli">Popular in the FEA community, similar properties as INT_HHT</p><ul>
<li>With the exception of one particular choice of parameters (in which it becomes the trapezoidal integration rule) it delivers first order accuracy</li>
</ul>
<p class="startli">In the above, the meaning of 'first order' or 'second order' accuracy is that the global integration error goes to zero as the value of the time step (or square of the time step for a second order method).</p>
</li>
</ul>
</li>
</ul>
<p>Depending on the type of time-stepper used, there may be different parameters to adjust. Example:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<span class="keyword">auto</span> mystepper = std::dynamic_pointer_cast&lt;ChTimestepperHHT&gt;(my_system.GetTimestepper())) {</div><div class="line">    mystepper-&gt;SetAlpha(-0.2);</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><p>See <a class="el" href="classchrono_1_1_ch_timestepper.html">chrono::ChTimestepper</a> for API details.</p>
<h1><a class="anchor" id="solvers"></a>
Solvers</h1>
<p>A solver is called by a time stepper to compute the unknown accelerations and unknown reaction forces at each time step of the simulation. Most often they represent the biggest computational bottleneck of the entire simulation.</p>
<p>Solvers can be changed in two ways:</p><ul>
<li>Using the <code>my_system.SetSolverType(...)</code> function, to choose a ready-to-use, pre-packaged option</li>
<li>Using the <code>my_system.ChangeSolverSpeed(...)</code> function, to plug in a custom time-stepper, which is user-defined</li>
</ul>
<p>Example:</p>
<div class="fragment"><div class="line">my_system.SetSolverType(ChSystem::SOLVER_SOR);</div></div><!-- fragment --><p>We recommend using one of the following iterative solvers:</p>
<ul>
<li><code>SOLVER_SOR</code><ul>
<li>low precision: convergence might stall, especially with odd mass ratios</li>
<li>supports DVI (hard contacts, with complementarity)</li>
<li>used most often for small problems, solution accuracy is not particularly important</li>
</ul>
</li>
<li><code>SOLVER_APGD</code><ul>
<li>very good convergence, used most often for simulations in which high accuracy in results is desired</li>
<li>supports DVI (hard contacts, with complementarity)</li>
</ul>
</li>
<li><code>SOLVER_BARZILAIBORWEIN</code><ul>
<li>good convergence<ul>
<li>supports DVI (hard contacts, with complementarity)</li>
</ul>
</li>
<li>similar to <code>SOLVER_APGD</code>, might be more robust when using large mass ratios</li>
</ul>
</li>
<li><code>SOLVER_MINRES</code><ul>
<li>good convergence</li>
<li>supports FEA problems</li>
<li>does nor support DVI (hard contacts, with complementarity) for the moment.</li>
</ul>
</li>
</ul>
<p>Most iterative solvers have a default value for the max number of iterations for convergence.</p>
<ul>
<li>When this number is higher, the solver has the chance to 'try harder', which might lead to longer simulation times</li>
<li>When this value is low, the solver is faster but the solution at the end of the iterative process might be not fully converged</li>
</ul>
<p>The max. number of iterations can be changed as follows:</p>
<div class="fragment"><div class="line"><span class="comment">// Change the max iterations for the solver</span></div><div class="line">my_system.SetMaxItersSolverSpeed(20);</div></div><!-- fragment --><p>Depending on the type of integrator used, there may be different parameters to adjust. Advanced settings are not accessible directly from <a class="el" href="classchrono_1_1_ch_system.html">chrono::ChSystem</a>, for instance:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<span class="keyword">auto</span> msolver = dynamic_cast&lt;chrono::ChSolverMINRES*&gt;(my_system.GetSolverSpeed())) {</div><div class="line">        msolver-&gt;SetDiagonalPreconditioning(<span class="keyword">true</span>);</div><div class="line">}</div></div><!-- fragment --><p>See <a class="el" href="classchrono_1_1_ch_solver.html">chrono::ChSolver</a> for API for further details.</p>
<h1><a class="anchor" id="other_simulation_parameters"></a>
Other parameters</h1>
<p>There are many integrator/solver settings that can affect the outcome of a simulation. For instance, see <a class="el" href="collision_shapes.html#collision_tolerances">collision tolerances</a> to gain a better understanding of the interplay between the accuracy in the collision detection and robustness of a simulation. We focus below on two important settings related to handling collisions in a simulation in which bodies collide with each other and/or with the ground.</p>
<h3>Max. recovery speed</h3>
<p>Bodies in contact that interpenetrate for various reasons, e.g., small numerical integration error, inconsistent initial conditions, etc., will not 'escape' this contact violation at a speed faster than this threshold. The recovery speed is in general problem dependent and is controlled by user as shown below.</p>
<div class="fragment"><div class="line">my_system.SetMaxPenetrationRecoverySpeed(0.2);</div></div><!-- fragment --><ul>
<li>Larger values allow a more aggressive correction of the penetration, yet this can lead to scenarios in which bodies in contact pop out fast or in stacking problems the stack becoming jittery, noisy</li>
<li>A small threshold increases the risk that objects <em>sink</em> into one another when integrator precision is low, for instance, when the solver has a small max number of iterations</li>
</ul>
<h3>Min. bounce speed</h3>
<p>When objects collide, if their incoming speed is lower than this threshold, a zero restitution coefficient is assumed. This helps to achieve more stable simulations of stacked objects.</p>
<div class="fragment"><div class="line">my_system.SetMinBounceSpeed(0.1);</div></div><!-- fragment --><ul>
<li>A higher value leads to more stable simulations but less physically realistic collisions</li>
<li>Lower values lead to a more physically realistic time evolution but require small integration time steps otherwise objects may keep bounce erratically</li>
</ul>
<h1>Theory</h1>
<p>Additional information regarding the time integration strategies implemented in Chrono can be found on the <a class="el" href="whitepaper_root.html">whitepapers page</a>. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 1 2016 15:43:10 for Project Chrono by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11 . <a href="mailto:info@projectchrono.org">Contact us</a> for issues related to this page. 
</small></address>
</body>
</html>
